{{define "registry_service.proto"}}syntax = "proto3";

package google.cloud.apigee.registry.v1alpha1;

import "registry_models.proto";
import "google/api/annotations.proto";
import "google/api/client.proto";
import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";

option java_package = "com.google.cloud.apigee.registry.v1alpha1";
option java_multiple_files = true;
option java_outer_classname = "RegistryServiceProto";
option go_package = "apigov.dev/registry/rpc;rpc";

// The Registry API provides structures and relationships for
// Full Lifecycle API Management. It enables API platform
// teams to build rich models of their API ecosystems and
// provide information and oversight to API producers and
// consumers in their organizations.
service Registry {
  option (google.api.default_host) = "registry.googleapis.com";
{{range .Entities}}{{template "rpcs" .}}{{end}}
}
{{range .Entities}}{{template "messages" .}}{{end}}
{{end}}

{{define "rpcs"}}
  // List{{.PluralName}} returns matching {{lower_comment .PluralName}}.{{if not .ParentName}}
  // (-- api-linter: standard-methods=disabled --)
  // (-- api-linter: core::0132::method-signature=disabled
  //     aip.dev/not-precedent: the organization is the implicit parent. --){{end}}
  rpc List{{.PluralName}}(List{{.PluralName}}Request) returns (List{{.PluralName}}Response) {
    option (google.api.http) = {
      get : "{{collection_path .ParentName .PluralName}}"
    };{{if .ParentName}}
    option (google.api.method_signature) = "parent";{{end}}
  }

  // Get{{.Name}} returns a specified {{lower_comment .Name}}.
  rpc Get{{.Name}}(Get{{.Name}}Request) returns ({{.Name}}) {
    option (google.api.http) = {
      get : "{{resource_path .ResourceName}}"
    };
    option (google.api.method_signature) = "name";
  }

  // Create{{.Name}} creates a specified {{lower_comment .Name}}.{{if not .ParentName}}
  // (-- api-linter: standard-methods=disabled --)
  // (-- api-linter: core::0133::http-uri-parent=disabled
  //     aip.dev/not-precedent: {{.Name}} has an implicit parent. --)
  // (-- api-linter: core::0133::method-signature=disabled
  //     aip.dev/not-precedent: {{.Name}} has an implicit parent. --){{end}}
  rpc Create{{.Name}}(Create{{.Name}}Request) returns ({{.Name}}) {
    option (google.api.http) = {
      post : "{{collection_path .ParentName .PluralName}}"
      body : "{{lower .Name}}"
    };{{if not .ParentName}}
    option (google.api.method_signature) = "{{lower .Name}},{{lower .Name}}_id";{{else}}
    option (google.api.method_signature) = "parent,{{lower .Name}},{{lower .Name}}_id";{{end}}
  }

  // Update{{.Name}} can be used to modify a specified {{lower_comment .Name}}.
  rpc Update{{.Name}}(Update{{.Name}}Request) returns ({{.Name}}) {
    option (google.api.http) = {
      patch : "{{resource_path_for_update .Name .ResourceName}}"
      body : "{{lower .Name}}"
    };
    option (google.api.method_signature) = "{{lower .Name}},update_mask";
  }

  // Delete{{.Name}} removes a specified {{lower_comment .Name}} and all of the resources that it
  // owns.
  rpc Delete{{.Name}}(Delete{{.Name}}Request) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete : "{{resource_path .ResourceName}}"
    };
    option (google.api.method_signature) = "name";
  }
{{end}}

{{define "messages"}}
// Request message for List{{.PluralName}}.{{if not .ParentName}}
// (-- api-linter: core::0132::request-parent-required=disabled
//     aip.dev/not-precedent: the parent of {{.Name}} is implicit. --){{end}}
message List{{.PluralName}}Request {
{{if .ParentName}}  // The parent, which owns this collection of {{lower_comment .PluralName}}.
  // Format: {{.ParentName}}
  string parent = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {child_type: "registry.googleapis.com/{{.Name}}"}
  ];
{{end}}  // The maximum number of {{lower_comment .PluralName}} to return.
  // The service may return fewer than this value.
  // If unspecified, at most 50 values will be returned.
  // The maximum is 1000; values above 1000 will be coerced to 1000.
  int32 page_size = 2;

  // A page token, received from a previous `List{{.PluralName}}` call.
  // Provide this to retrieve the subsequent page.
  //
  // When paginating, all other parameters provided to `List{{.PluralName}}` must match
  // the call that provided the page token.
  string page_token = 3;

  // An optional expression that can be used to filter the list.
  string filter = 4;{{if .ViewEnumName}}

  // The level of detail to return (defaults to BASIC).
  {{.ViewEnumName}} view = 5;{{end}}{{if .ExtraRequestFields}}
{{.ExtraRequestFields}}{{end}}
}

// Response message for List{{.PluralName}}.
message List{{.PluralName}}Response {
  // The {{lower_comment .PluralName}} from the specified publisher.
  repeated {{.Name}} {{lower .PluralName}} = 1;

  // A token, which can be sent as `page_token` to retrieve the next page.
  // If this field is omitted, there are no subsequent pages.
  string next_page_token = 2;
}

// Request message for Get{{.Name}}.
message Get{{.Name}}Request {
  // The name of the {{lower_comment .Name}} to retrieve.
  // Format: {{.ResourceName}}
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "registry.googleapis.com/{{.Name}}"
    }
  ];{{if .ViewEnumName}}

  // The level of detail to return (defaults to BASIC).
  {{.ViewEnumName}} view = 2;{{end}}
}

// Request message for Create{{.Name}}.{{if not .ParentName}}
// (-- api-linter: core::0133::request-parent-required=disabled
//     aip.dev/not-precedent: the parent of {{.Name}} is implicit. --){{end}}
message Create{{.Name}}Request {
{{if .ParentName}}  // The parent, which owns this collection of {{lower_comment .PluralName}}.
  // Format: {{.ParentName}}
  string parent = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {child_type: "registry.googleapis.com/{{.Name}}"}
  ];
{{end}}  // The {{lower_comment .Name}} to create.
  {{.Name}} {{lower .Name}} = 2 [ (google.api.field_behavior) = REQUIRED ];
  // The ID to use for the {{lower .Name}}, which will become the final component of
  // the {{lower .Name}}'s resource name.
  //
  // This value should be 4-63 characters, and valid characters
  // are /[a-z][0-9]-/.
  string {{lower .Name}}_id = 3;
}

// Request message for Update{{.Name}}.
message Update{{.Name}}Request {
  // The {{lower_comment .Name}} to update.
  //
  // The `name` field is used to identify the {{lower_comment .Name}} to update.
  // Format: {{.ResourceName}}
  {{.Name}} {{lower .Name}} = 1 [ (google.api.field_behavior) = REQUIRED ];

  // The list of fields to be updated.
  google.protobuf.FieldMask update_mask = 2;
}

// Request message for Delete{{.Name}}.
message Delete{{.Name}}Request {
  // The name of the {{lower_comment .Name}} to delete.
  // Format: {{.ResourceName}}
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {type : "registry.googleapis.com/{{.Name}}"}
  ];
}
{{end}}
